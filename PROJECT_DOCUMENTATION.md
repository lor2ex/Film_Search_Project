# üìö –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ Film Search

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞](#–æ–±–∑–æ—Ä-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–ú–æ–¥—É–ª–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#–º–æ–¥—É–ª–∏-–∏-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
4. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
5. [API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#api-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
6. [Frontend](#frontend)
7. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

---

## –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
Film Search - —ç—Ç–æ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ñ–∏–ª—å–º–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Sakila —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤–Ω–µ—à–Ω–∏—Ö API, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –ú–Ω–æ–≥–æ–∫—Ä–∏—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –∂–∞–Ω—Ä, –≥–æ–¥, –∞–∫—Ç—ë—Ä)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TMDB API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ—Å—Ç–µ—Ä–æ–≤
- –£–º–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤—ã–º—ã—à–ª–µ–Ω–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ñ–∏–ª—å–º–∞–º–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ MongoDB
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ–∏—Å–∫–æ–≤
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **Backend**: FastAPI (Python 3.9+)
- **Databases**: MySQL (Sakila), MongoDB
- **Frontend**: HTML5, CSS3, Vanilla JavaScript
- **External APIs**: TMDB (The Movie Database)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Browser   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ HTTP/AJAX
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   FastAPI   ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ main.py (Entry Point)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚ñ∫ app/routes/films.py (API Endpoints)
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚ñ∫ app/database/mysql_connector.py (MySQL DAO)
       ‚îÇ    ‚îî‚îÄ‚îÄ‚ñ∫ MySQL Sakila DB
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚ñ∫ app/logging/log_writer.py (Logging)
       ‚îÇ    ‚îî‚îÄ‚îÄ‚ñ∫ MongoDB
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚ñ∫ app/logging/log_stats.py (Statistics)
       ‚îÇ    ‚îî‚îÄ‚îÄ‚ñ∫ MongoDB
       ‚îÇ
       ‚îî‚îÄ‚îÄ‚ñ∫ app/utils/formatter.py (TMDB API)
            ‚îî‚îÄ‚îÄ‚ñ∫ TMDB API
```

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **DAO (Data Access Object)** - –∏–∑–æ–ª—è—Ü–∏—è –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã —Å –ë–î
- **Repository Pattern** - –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
- **Dependency Injection** - —á–µ—Ä–µ–∑ FastAPI
- **Singleton** - –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î

---

## –ú–æ–¥—É–ª–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. main.py - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
```python
app = FastAPI(
    title="Film Search API",
    description="API –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ñ–∏–ª—å–º–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Sakila",
    version="1.0.0"
)
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**:
- –°–æ–∑–¥–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç CORS –¥–ª—è –∫—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü–æ–¥–∫–ª—é—á–∞–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (CSS, JS)
- –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã –∏–∑ `app/routes/films.py`
- –ó–∞–ø—É—Å–∫–∞–µ—Ç Uvicorn —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 8000

**Endpoints**:
- `GET /` - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (index.html)
- `GET /health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

### 2. app/database/mysql_connector.py - MySQL DAO

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: Data Access Object –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å MySQL –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö Sakila

**–ö–ª–∞—Å—Å**: `MySQLConnector`

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
mysql_db = MySQLConnector(dbconfig)
```

**–ú–µ—Ç–æ–¥—ã**:

#### `_connect()` - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å MySQL
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (2003, 1045)
- –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

#### `_execute_query(query, params)` - –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- –í—ã–ø–æ–ª–Ω—è–µ—Ç SELECT –∑–∞–ø—Ä–æ—Å—ã —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –ó–∞—â–∏—Ç–∞ –æ—Ç SQL injection —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—é
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–∫ —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

#### `search_by_keyword(keyword, page, page_size)` - –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
```python
films, total = mysql_db.search_by_keyword("matrix", page=1, page_size=10)
```
- SQL: `SELECT ... FROM film WHERE title LIKE %keyword%`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: (—Å–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤, –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)
- –ü–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è —Å OFFSET

#### `search_by_genre_and_year(genre, year_from, year_to, page, page_size)`
```python
films, total = mysql_db.search_by_genre_and_year("Action", 2000, 2010, 1, 10)
```
- SQL: JOIN —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ film_category –∏ category
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∂–∞–Ω—Ä—É –∏ –¥–∏–∞–ø–∞–∑–æ–Ω—É –ª–µ—Ç
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å–º—ã (DISTINCT)

#### `search_by_genre(genre, page, page_size)` - –ü–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –∂–∞–Ω—Ä—É
- –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –≥–æ–¥–∞–º
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

#### `search_by_actor(actor_id, page, page_size)` - –ü–æ–∏—Å–∫ –ø–æ –∞–∫—Ç—ë—Ä—É
```python
films, total = mysql_db.search_by_actor(actor_id=1, page=1, page_size=10)
```
- SQL: JOIN —Å —Ç–∞–±–ª–∏—Ü–µ–π film_actor
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ —Ñ–∏–ª—å–º—ã —Å —É—á–∞—Å—Ç–∏–µ–º –∞–∫—Ç—ë—Ä–∞

#### `get_all_genres()` - –°–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã category
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É

#### `get_all_actors()` - –°–ø–∏—Å–æ–∫ –∞–∫—Ç—ë—Ä–æ–≤
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤—ã—Ö 100 –∞–∫—Ç—ë—Ä–æ–≤
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∏–º–µ–Ω–∏ –∏ —Ñ–∞–º–∏–ª–∏–∏

#### `get_year_range()` - –î–∏–∞–ø–∞–∑–æ–Ω –ª–µ—Ç
- MIN –∏ MAX –≥–æ–¥ –≤—ã–ø—É—Å–∫–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã film
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤

#### `get_year_range_for_genre(genre)` - –î–∏–∞–ø–∞–∑–æ–Ω –¥–ª—è –∂–∞–Ω—Ä–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≥–æ–¥—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∂–∞–Ω—Ä–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤

#### `get_film_actors(film_id)` - –ê–∫—Ç—ë—Ä—ã —Ñ–∏–ª—å–º–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–∫—Ç—ë—Ä–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∏–ª—å–º–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±–æ–≥–∞—â–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

#### `get_film_categories(film_id)` - –ñ–∞–Ω—Ä—ã —Ñ–∏–ª—å–º–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤ –¥–ª—è —Ñ–∏–ª—å–º–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±–æ–≥–∞—â–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

#### `get_actor_by_id(actor_id)` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–∫—Ç—ë—Ä–µ
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é –∞–∫—Ç—ë—Ä–∞ –ø–æ ID
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∏–º–µ–Ω–µ–º –≤–º–µ—Å—Ç–æ ID

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
- –í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- Graceful degradation

---

### 3. app/logging/log_writer.py - –ó–∞–ø–∏—Å—å –ª–æ–≥–æ–≤

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ó–∞–ø–∏—Å—å –≤—Å–µ—Ö –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ MongoDB

**–ö–ª–∞—Å—Å**: `LogWriter`

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
log_writer = LogWriter(
    mongodb_url=MONGODB_URL_WRITE,
    database_name='ich_edit',
    collection_name='final_project_010825_ptm_al'
)
```

**–ú–µ—Ç–æ–¥—ã**:

#### `_connect()` - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å MongoDB
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ ping
- –¢–∞–π–º–∞—É—Ç: 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–µ—Ä–≤–µ—Ä–∞, 10 —Å–µ–∫—É–Ω–¥ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

#### `log_search(search_type, params, results_count, execution_time_ms)`
```python
log_writer.log_search(
    search_type="keyword",
    params={"keyword": "matrix"},
    results_count=10,
    execution_time_ms=125.5
)
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–∞**:
```json
{
    "timestamp": "2026-01-13T16:04:10.326773",
    "search_type": "keyword",
    "params": {"keyword": "matrix"},
    "results_count": 10,
    "execution_time_ms": 125.5
}
```

**–¢–∏–ø—ã –ø–æ–∏—Å–∫–æ–≤**:
- `keyword` - –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
- `genre__years_range` - –ø–æ–∏—Å–∫ –ø–æ –∂–∞–Ω—Ä—É –∏ –≥–æ–¥—É
- `genre` - –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –∂–∞–Ω—Ä—É
- `actor` - –ø–æ–∏—Å–∫ –ø–æ –∞–∫—Ç—ë—Ä—É

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ (UTC)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –∞–∫—Ç—ë—Ä–∞ –≤–º–µ—Å—Ç–æ ID
- –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏)

---

### 4. app/logging/log_stats.py - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–∏—Å–∫–æ–≤ –∏–∑ MongoDB

**–ö–ª–∞—Å—Å**: `LogStats`

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
log_stats = LogStats(
    mongodb_url=MONGODB_URL_READ,
    database_name='ich_edit'
)
```

**–ú–µ—Ç–æ–¥—ã**:

#### `get_popular_searches(limit=5)` - –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
```python
popular = log_stats.get_popular_searches(limit=5)
```

**MongoDB Aggregation Pipeline**:
```javascript
[
    {
        $addFields: {
            normalized_params: {
                // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –±–µ–∑ page
            }
        }
    },
    {
        $group: {
            _id: {
                search_type: "$search_type",
                params: "$normalized_params"
            },
            count: { $sum: 1 },
            last_timestamp: { $max: "$timestamp" }
        }
    },
    {
        $sort: { count: -1, last_timestamp: -1 }
    },
    {
        $limit: 5
    }
]
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**:
```python
[
    {
        "_id": {
            "search_type": "keyword",
            "params": {"keyword": "ape"}
        },
        "count": 22,
        "last_timestamp": "2026-01-13T16:04:10"
    },
    ...
]
```

#### `get_recent_searches(limit=5)` - –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∏—Å–∫–∏
```python
recent = log_stats.get_recent_searches(limit=5)
```

**MongoDB Aggregation Pipeline**:
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ timestamp (DESC)
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—è–º
- –í—ã–±–æ—Ä –ø–µ—Ä–≤–æ–≥–æ (—Å–∞–º–æ–≥–æ —Å–≤–µ–∂–µ–≥–æ) –∏–∑ –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã
- –§–∏–Ω–∞–ª—å–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ –ª–∏–º–∏—Ç

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**:
```python
[
    {
        "timestamp": "2026-01-13T16:04:10",
        "search_type": "keyword",
        "params": {"keyword": "ape"},
        "results_count": 10,
        "execution_time_ms": 544.54
    },
    ...
]
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –£–º–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–∏—Å–∫–ª—é—á–∞–µ—Ç page)
- –†–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å—Ç–∞—Ä—ã–º–∏ –∑–∞–ø–∏—Å—è–º–∏ (—Å page) –∏ –Ω–æ–≤—ã–º–∏ (–±–µ–∑ page)
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —á–∞—Å—Ç–æ—Ç–µ –∏ –≤—Ä–µ–º–µ–Ω–∏

---

### 5. app/utils/formatter.py - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ TMDB API

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TMDB API –¥–ª—è –ø–æ—Å—Ç–µ—Ä–æ–≤

**–§—É–Ω–∫—Ü–∏–∏**:

#### `format_film_response(film, actors, categories)`
```python
formatted = format_film_response(
    film={'film_id': 1, 'title': 'ACADEMY DINOSAUR', ...},
    actors=['John Doe', 'Jane Smith'],
    categories=['Action', 'Drama']
)
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**:
```python
{
    "film_id": 1,
    "title": "ACADEMY DINOSAUR",
    "description": "A Epic Drama...",
    "release_year": 2006,
    "length": 86,
    "rating": "PG",
    "actors": ["John Doe", "Jane Smith"],
    "categories": ["Action", "Drama"],
    "poster": "https://image.tmdb.org/t/p/w500/..."
}
```

#### `get_poster_for_film(title, year)` - –£–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç–µ—Ä–æ–≤

**–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã** (5 —É—Ä–æ–≤–Ω–µ–π):

**–£—Ä–æ–≤–µ–Ω—å 1: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫**
```python
poster = search_movie_poster(title, year)
```
- –ü–æ–∏—Å–∫ –≤ TMDB –ø–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É –Ω–∞–∑–≤–∞–Ω–∏—é

**–£—Ä–æ–≤–µ–Ω—å 2: –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ñ–∏–ª—å–º–∞–º–∏**
```python
real_title = map_to_real_movie(title, year)
if real_title != title:
    poster = search_movie_poster(real_title, year)
```
- 60+ –≥–æ—Ç–æ–≤—ã—Ö —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π
- `ACADEMY DINOSAUR` ‚Üí `Jurassic Park`

**–£—Ä–æ–≤–µ–Ω—å 3: –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ñ–∏–ª—å–º—ã –ø–æ –≥–æ–¥—É**
```python
random_title = get_random_popular_movie(year)
poster = search_movie_poster(random_title, year)
```
- –ë–∞–∑–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤ 1997-2006
- –°—Ç–∞–±–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ö–µ—à–∞

**–£—Ä–æ–≤–µ–Ω—å 4: –°–ª—É—á–∞–π–Ω—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —Ñ–∏–ª—å–º**
```python
random_title = get_fallback_movie(title)
poster = search_movie_poster(random_title, None)
```
- 30+ —Ç–æ–ø–æ–≤—ã—Ö —Ñ–∏–ª—å–º–æ–≤ –≤—Å–µ—Ö –≤—Ä–µ–º–µ–Ω
- –°—Ç–∞–±–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ö–µ—à–∞ –Ω–∞–∑–≤–∞–Ω–∏—è

**–£—Ä–æ–≤–µ–Ω—å 5: –≠–º–æ–¥–∑–∏ —Ä–µ–∑–µ—Ä–≤**
```python
return get_default_poster_emoji(title)
```
- 10 –∫—Ä–∞—Å–∏–≤—ã—Ö —ç–º–æ–¥–∑–∏
- –°—Ç–∞–±–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ö–µ—à–∞

#### `search_movie_poster(title, year)` - –ü–æ–∏—Å–∫ –≤ TMDB
```python
poster_url = search_movie_poster("Jurassic Park", 1993)
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: "https://image.tmdb.org/t/p/w500/kGLOLum7xU95spakBEfxCjEfNn0.jpg"
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞**:
- `api_key` - –∫–ª—é—á TMDB API
- `query` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞
- `year` - –≥–æ–¥ –≤—ã–ø—É—Å–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `language` - "ru-RU" –¥–ª—è —Ä—É—Å—Å–∫–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π

**–û–±—Ä–∞–±–æ—Ç–∫–∞**:
- –¢–∞–π–º–∞—É—Ç 5 —Å–µ–∫—É–Ω–¥
- –ë–µ—Ä–µ—Ç –ø–µ—Ä–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ –ø–æ–∏—Å–∫–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç URL –ø–æ—Å—Ç–µ—Ä–∞ –∏–ª–∏ None

#### `map_to_real_movie(sakila_title, year)` - –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ

**–ë–∞–∑–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π** (60+ —Ñ–∏–ª—å–º–æ–≤):
```python
sakila_to_real = {
    'ACADEMY DINOSAUR': 'Jurassic Park',
    'ACE GOLDFINGER': 'Goldfinger',
    'ADAPTATION HOLES': 'The Shawshank Redemption',
    'AFFAIR PREJUDICE': 'Pride and Prejudice',
    'AFRICAN EGG': 'The Lion King',
    'AGENT TRUMAN': 'The Truman Show',
    'AIRPLANE SIERRA': 'Top Gun',
    'ALADDIN CALENDAR': 'Aladdin',
    'ALIEN CENTER': 'Alien',
    'AMADEUS HOLY': 'Amadeus',
    # ... –µ—â–µ 50+ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π
}
```

#### `get_random_popular_movie(year)` - –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø–æ –≥–æ–¥—É

**–ë–∞–∑–∞ –ø–æ –≥–æ–¥–∞–º**:
```python
popular_by_year = {
    2006: ['The Departed', 'Casino Royale', 'Pirates of the Caribbean', ...],
    2005: ['Star Wars: Episode III', 'Harry Potter', ...],
    2004: ['Shrek 2', 'Spider-Man 2', ...],
    # ... 1997-2006
}
```

#### `get_fallback_movie(title)` - –†–µ–∑–µ—Ä–≤–Ω—ã–µ —Ñ–∏–ª—å–º—ã

**–¢–æ–ø-30 —Ñ–∏–ª—å–º–æ–≤**:
```python
fallback_movies = [
    'The Shawshank Redemption',
    'The Godfather',
    'The Dark Knight',
    'Pulp Fiction',
    'The Matrix',
    # ... –µ—â–µ 25 —Ñ–∏–ª—å–º–æ–≤
]
```

#### `get_default_poster_emoji(title)` - –≠–º–æ–¥–∑–∏ –ø–æ—Å—Ç–µ—Ä—ã

**10 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤**:
```python
default_posters = ['üé¨', 'üé•', 'üìΩÔ∏è', 'üéûÔ∏è', 'üçø', 'üé™', 'üé≠', 'üé®', 'üåü', '‚ú®']
```

**–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**:
```python
POSTER_CACHE = {}  # –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫—ç—à
# –ö–ª—é—á: "title_year" –∏–ª–∏ "title"
# –ó–Ω–∞—á–µ–Ω–∏–µ: URL –∏–ª–∏ —ç–º–æ–¥–∑–∏
```

---

### 6. app/routes/films.py - API –º–∞—Ä—à—Ä—É—Ç—ã

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Å–µ—Ö API endpoints –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∏–ª—å–º–∞–º–∏

**–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã**:
```python
mysql_db = MySQLConnector(dbconfig)
log_writer = LogWriter(MONGODB_URL_WRITE)
log_stats = LogStats(MONGODB_URL_READ)
```

**Endpoints**:

#### `GET /api/search/keyword` - –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
```python
@router.get("/api/search/keyword")
async def search_by_keyword(
    q: str = Query(..., min_length=1, max_length=100),
    page: int = Query(1, ge=1)
)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `q` - –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, 1-100 —Å–∏–º–≤–æ–ª–æ–≤)
- `page` - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)

**–ü—Ä–æ—Ü–µ—Å—Å**:
1. –ü–æ–∏—Å–∫ –≤ MySQL: `mysql_db.search_by_keyword(q, page, 10)`
2. –û–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–∞–∫—Ç—ë—Ä—ã, –∂–∞–Ω—Ä—ã, –ø–æ—Å—Ç–µ—Ä—ã)
3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ MongoDB
4. –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–û—Ç–≤–µ—Ç**:
```json
{
    "total_count": 22,
    "page": 1,
    "page_size": 10,
    "films": [...]
}
```

#### `GET /api/search/genre-year` - –ü–æ–∏—Å–∫ –ø–æ –∂–∞–Ω—Ä—É –∏ –≥–æ–¥—É
```python
@router.get("/api/search/genre-year")
async def search_by_genre_and_year(
    genre: str = Query(...),
    year_from: int = Query(2000, ge=1895, le=2030),
    year_to: int = Query(2023, ge=1895, le=2030),
    page: int = Query(1, ge=1)
)
```

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
```python
log_writer.log_search(
    search_type="genre__years_range",
    params={
        "genre": genre,
        "years_range": f"{year_from}-{year_to}"
    },
    results_count=len(films),
    execution_time_ms=execution_time * 1000
)
```

#### `GET /api/search/genre` - –ü–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –∂–∞–Ω—Ä—É
- –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –≥–æ–¥–∞–º
- –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫

#### `GET /api/search/actor` - –ü–æ–∏—Å–∫ –ø–æ –∞–∫—Ç—ë—Ä—É
```python
@router.get("/api/search/actor")
async def search_by_actor(
    actor_id: int = Query(..., ge=1),
    page: int = Query(1, ge=1)
)
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**:
```python
# –ü–æ–ª—É—á–∞–µ–º –∏–º—è –∞–∫—Ç—ë—Ä–∞ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
actor_info = mysql_db.get_actor_by_id(actor_id)
actor_name = f"{actor_info['first_name']} {actor_info['last_name']}"

log_writer.log_search(
    search_type="actor",
    params={"actor_name": actor_name},  # –ò–º—è, –∞ –Ω–µ ID!
    ...
)
```

#### `GET /api/genres` - –°–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤
```python
@router.get("/api/genres", response_model=List[GenreResponse])
async def get_genres()
```

**–û—Ç–≤–µ—Ç**:
```json
[
    {"category_id": 1, "name": "Action"},
    {"category_id": 2, "name": "Animation"},
    ...
]
```

#### `GET /api/actors` - –°–ø–∏—Å–æ–∫ –∞–∫—Ç—ë—Ä–æ–≤
```python
@router.get("/api/actors", response_model=List[ActorResponse])
async def get_actors()
```

**–û—Ç–≤–µ—Ç**:
```json
[
    {
        "actor_id": 1,
        "first_name": "Penelope",
        "last_name": "Guiness",
        "full_name": "Penelope Guiness"
    },
    ...
]
```

#### `GET /api/year-range` - –î–∏–∞–ø–∞–∑–æ–Ω –ª–µ—Ç
```python
@router.get("/api/year-range", response_model=YearRangeResponse)
async def get_year_range()
```

**–û—Ç–≤–µ—Ç**:
```json
{
    "min_year": 2000,
    "max_year": 2023
}
```

#### `GET /api/year-range-for-genre` - –î–∏–∞–ø–∞–∑–æ–Ω –¥–ª—è –∂–∞–Ω—Ä–∞
```python
@router.get("/api/year-range-for-genre")
async def get_year_range_for_genre(
    genre: str = Query(...)
)
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∂–∞–Ω—Ä–∞

#### `GET /api/stats/popular` - –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
```python
@router.get("/api/stats/popular")
async def get_popular_stats()
```

**–û—Ç–≤–µ—Ç**:
```json
{
    "popular_searches": [
        {
            "_id": {
                "search_type": "keyword",
                "params": {"keyword": "ape"}
            },
            "count": 22
        },
        ...
    ]
}
```

#### `GET /api/stats/recent` - –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∏—Å–∫–∏
```python
@router.get("/api/stats/recent")
async def get_recent_stats()
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:
- –í—Å–µ endpoints –æ–±–µ—Ä–Ω—É—Ç—ã –≤ try-except
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- –í–æ–∑–≤—Ä–∞—Ç –ø–æ–Ω—è—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç—É
- Graceful degradation

---

### 7. app/models/schemas.py - Pydantic –º–æ–¥–µ–ª–∏

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä

**–ú–æ–¥–µ–ª–∏**:

#### `FilmBase` - –ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å —Ñ–∏–ª—å–º–∞
```python
class FilmBase(BaseModel):
    film_id: int
    title: str
    description: Optional[str] = None
    release_year: int
    language_id: int
```

#### `FilmDetail` - –î–µ—Ç–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å
```python
class FilmDetail(FilmBase):
    length: Optional[int] = None
    rating: Optional[str] = None
    categories: Optional[List[str]] = None
    actors: Optional[List[str]] = None
```

#### `GenreResponse` - –ú–æ–¥–µ–ª—å –∂–∞–Ω—Ä–∞
```python
class GenreResponse(BaseModel):
    category_id: int
    name: str
```

#### `ActorResponse` - –ú–æ–¥–µ–ª—å –∞–∫—Ç—ë—Ä–∞
```python
class ActorResponse(BaseModel):
    actor_id: int
    first_name: str
    last_name: str
    full_name: str
```

#### `YearRangeResponse` - –î–∏–∞–ø–∞–∑–æ–Ω –ª–µ—Ç
```python
class YearRangeResponse(BaseModel):
    min_year: int
    max_year: int
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è OpenAPI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- Type hints –¥–ª—è IDE

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### MySQL (Sakila)

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã**:

#### `film` - –§–∏–ª—å–º—ã
```sql
CREATE TABLE film (
    film_id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    release_year YEAR,
    language_id TINYINT UNSIGNED NOT NULL,
    length SMALLINT UNSIGNED,
    rating ENUM('G','PG','PG-13','R','NC-17'),
    PRIMARY KEY (film_id)
);
```

#### `category` - –ñ–∞–Ω—Ä—ã
```sql
CREATE TABLE category (
    category_id TINYINT UNSIGNED NOT NULL AUTO_INCREMENT,
    name VARCHAR(25) NOT NULL,
    PRIMARY KEY (category_id)
);
```

#### `film_category` - –°–≤—è–∑—å —Ñ–∏–ª—å–º–æ–≤ –∏ –∂–∞–Ω—Ä–æ–≤
```sql
CREATE TABLE film_category (
    film_id SMALLINT UNSIGNED NOT NULL,
    category_id TINYINT UNSIGNED NOT NULL,
    PRIMARY KEY (film_id, category_id),
    FOREIGN KEY (film_id) REFERENCES film (film_id),
    FOREIGN KEY (category_id) REFERENCES category (category_id)
);
```

#### `actor` - –ê–∫—Ç—ë—Ä—ã
```sql
CREATE TABLE actor (
    actor_id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    first_name VARCHAR(45) NOT NULL,
    last_name VARCHAR(45) NOT NULL,
    PRIMARY KEY (actor_id)
);
```

#### `film_actor` - –°–≤—è–∑—å —Ñ–∏–ª—å–º–æ–≤ –∏ –∞–∫—Ç—ë—Ä–æ–≤
```sql
CREATE TABLE film_actor (
    actor_id SMALLINT UNSIGNED NOT NULL,
    film_id SMALLINT UNSIGNED NOT NULL,
    PRIMARY KEY (actor_id, film_id),
    FOREIGN KEY (actor_id) REFERENCES actor (actor_id),
    FOREIGN KEY (film_id) REFERENCES film (film_id)
);
```

**–ò–Ω–¥–µ–∫—Å—ã**:
- PRIMARY KEY –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
- FOREIGN KEY –¥–ª—è —Å–≤—è–∑–µ–π
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª—è—Ö (title, name)

### MongoDB

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: `ich_edit`
**–ö–æ–ª–ª–µ–∫—Ü–∏—è**: `final_project_010825_ptm_al`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞**:
```json
{
    "_id": ObjectId("..."),
    "timestamp": "2026-01-13T16:04:10.326773",
    "search_type": "keyword",
    "params": {
        "keyword": "ape"
    },
    "results_count": 10,
    "execution_time_ms": 544.54
}
```

**–ò–Ω–¥–µ–∫—Å—ã** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ):
```javascript
db.final_project_010825_ptm_al.createIndex({ "timestamp": -1 })
db.final_project_010825_ptm_al.createIndex({ "search_type": 1 })
db.final_project_010825_ptm_al.createIndex({ "search_type": 1, "params": 1 })
```

---

## Frontend

### static/index.html - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
```html
<div class="container">
    <header class="header">
        <h1>üé¨ Film Search</h1>
    </header>
    
    <main class="main-content">
        <!-- –í–∫–ª–∞–¥–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
        <div class="tabs">
            <button class="tab-button active">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</button>
            <button class="tab-button">–ü–æ –∂–∞–Ω—Ä—É –∏ –≥–æ–¥—É</button>
            <button class="tab-button">–ü–æ –∞–∫—Ç—ë—Ä—É</button>
            <button class="tab-button">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
        <div id="keyword" class="tab-content active">...</div>
        <div id="genre" class="tab-content">...</div>
        <div id="actor" class="tab-content">...</div>
        <div id="stats" class="tab-content">...</div>
    </main>
</div>
```

**–§–æ—Ä–º—ã –ø–æ–∏—Å–∫–∞**:
- –ü–æ–ª–µ –≤–≤–æ–¥–∞ –¥–ª—è –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
- –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤
- –ü–æ–ª—è –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –ª–µ—Ç
- –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –∞–∫—Ç—ë—Ä–æ–≤

### static/js/script.js - JavaScript –ª–æ–≥–∏–∫–∞

**–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**:
```javascript
const API_BASE = '/api';
window.currentSearchFunction = null;  // –î–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
```

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:

#### `switchTab(tabName)` - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
```javascript
function switchTab(tabName) {
    // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
    // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
}
```

#### `searchByKeyword(page)` - –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
```javascript
async function searchByKeyword(page = 1) {
    const keyword = document.getElementById('keyword-input').value.trim();
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
    window.currentSearchFunction = (p) => searchByKeyword(p);
    
    // AJAX –∑–∞–ø—Ä–æ—Å
    const response = await fetch(`${API_BASE}/search/keyword?q=${keyword}&page=${page}`);
    const data = await response.json();
    
    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    displayResults('keyword-results', data.films, data.total_count, data.page, data.page_size);
}
```

#### `searchByGenreYear(page)` - –ü–æ–∏—Å–∫ –ø–æ –∂–∞–Ω—Ä—É –∏ –≥–æ–¥—É
```javascript
async function searchByGenreYear(page = 1) {
    const genre = document.getElementById('genre-select').value;
    const yearFrom = parseInt(document.getElementById('year-from').value);
    const yearTo = parseInt(document.getElementById('year-to').value);
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (yearFrom > yearTo) {
        showError('genre-results', '–ì–æ–¥ –Ω–∞—á–∞–ª–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –≥–æ–¥–∞ –∫–æ–Ω—Ü–∞');
        return;
    }
    
    // AJAX –∑–∞–ø—Ä–æ—Å –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
}
```

#### `searchByActor(page)` - –ü–æ–∏—Å–∫ –ø–æ –∞–∫—Ç—ë—Ä—É
```javascript
async function searchByActor(page = 1) {
    const actorId = document.getElementById('actor-select').value;
    
    // AJAX –∑–∞–ø—Ä–æ—Å –∫ /api/search/actor
}
```

#### `displayResults(containerId, films, totalCount, currentPage, pageSize)`
```javascript
function displayResults(containerId, films, totalCount, currentPage, pageSize) {
    // –°–æ–∑–¥–∞–Ω–∏–µ HTML –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Ñ–∏–ª—å–º–æ–≤
    let html = '<div class="film-grid">';
    
    films.forEach(film => {
        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø–æ—Å—Ç–µ—Ä–∞ (URL –∏–ª–∏ —ç–º–æ–¥–∑–∏)
        let posterElement;
        if (film.poster && film.poster.startsWith('http')) {
            posterElement = `<img src="${film.poster}" ...>`;
        } else {
            posterElement = `<div class="film-poster-emoji">${film.poster}</div>`;
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ñ–∏–ª—å–º–∞
        html += `
            <div class="film-card">
                <div class="film-poster">${posterElement}</div>
                <div class="film-info">
                    <div class="film-title">${film.title}</div>
                    <div class="film-year">üìÖ ${film.release_year}</div>
                    <div class="film-description">${film.description}</div>
                    <div class="film-metadata">
                        <!-- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ä–µ–π—Ç–∏–Ω–≥, –∞–∫—Ç—ë—Ä—ã, –∂–∞–Ω—Ä—ã -->
                    </div>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
    if (totalPages > 1) {
        html += '<div class="pagination">...</div>';
    }
    
    container.innerHTML = html;
}
```

#### `loadGenres()` - –ó–∞–≥—Ä—É–∑–∫–∞ –∂–∞–Ω—Ä–æ–≤
```javascript
async function loadGenres() {
    const response = await fetch(`${API_BASE}/genres`);
    const genres = await response.json();
    
    // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ select
    const select = document.getElementById('genre-select');
    genres.forEach(genre => {
        const option = document.createElement('option');
        option.value = genre.name;
        option.textContent = genre.name;
        select.appendChild(option);
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∂–∞–Ω—Ä–∞
    select.addEventListener('change', async function() {
        if (this.value) {
            await updateYearRangeForGenre(this.value);
        }
    });
}
```

#### `updateYearRangeForGenre(genre)` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –ª–µ—Ç
```javascript
async function updateYearRangeForGenre(genre) {
    const response = await fetch(`${API_BASE}/year-range-for-genre?genre=${genre}`);
    const data = await response.json();
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
    document.getElementById('year-from').value = data.min_year;
    document.getElementById('year-to').value = data.max_year;
    
    // –ü–æ–∫–∞–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    const genreResults = document.getElementById('genre-results');
    genreResults.innerHTML = `
        <div class="info-message">
            üìÖ –î–ª—è –∂–∞–Ω—Ä–∞ "${genre}" –¥–æ—Å—Ç—É–ø–Ω—ã —Ñ–∏–ª—å–º—ã —Å ${data.min_year} –ø–æ ${data.max_year} –≥–æ–¥
        </div>
    `;
}
```

#### `loadStats()` - –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```javascript
async function loadStats() {
    // –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
    const popularResponse = await fetch(`${API_BASE}/stats/popular`);
    const popularData = await popularResponse.json();
    displayPopularStats(popularData.popular_searches);
    
    // –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∏—Å–∫–∏
    const recentResponse = await fetch(`${API_BASE}/stats/recent`);
    const recentData = await recentResponse.json();
    displayRecentStats(recentData.recent_searches);
}
```

#### `displayPopularStats(searches)` - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö
```javascript
function displayPopularStats(searches) {
    let html = '';
    searches.forEach((item, index) => {
        const searchType = item._id?.search_type || item.search_type;
        const params = item._id?.params || item.params;
        
        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        let typeLabel = '';
        let paramsText = '';
        
        if (searchType === 'keyword') {
            typeLabel = 'üî§ –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é';
            paramsText = `"${params.keyword}"`;
        } else if (searchType === 'genre__years_range') {
            typeLabel = 'üé≠ –ü–æ–∏—Å–∫ –ø–æ –∂–∞–Ω—Ä—É –∏ –≥–æ–¥—É';
            paramsText = `${params.genre} (${params.years_range})`;
        } else if (searchType === 'actor') {
            typeLabel = 'üë• –ü–æ–∏—Å–∫ –ø–æ –∞–∫—Ç—ë—Ä—É';
            paramsText = params.actor_name;
        }
        
        html += `
            <div class="stat-item">
                <div class="stat-type">${index + 1}. ${typeLabel}</div>
                <div class="stat-params">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: ${paramsText}</div>
                <div class="stat-count">–í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${item.count} —Ä–∞–∑(–∞)</div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}
```

**–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
- `showLoading(containerId)` - –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
- `showError(containerId, message)` - –ø–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
- `escapeHtml(text)` - —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**:
```javascript
document.addEventListener('DOMContentLoaded', () => {
    loadYearRange();
    loadGenres();
    loadActors();
    
    // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Enter –≤ –ø–æ–ª—è—Ö –≤–≤–æ–¥–∞
    document.getElementById('keyword-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') searchByKeyword(1);
    });
});
```

---

### static/css/styles.css - –°—Ç–∏–ª–∏

**–î–∏–∑–∞–π–Ω —Å–∏—Å—Ç–µ–º–∞**: Perplexity Design System

**CSS Variables**:
```css
:root {
    /* –¶–≤–µ—Ç–∞ */
    --color-background: var(--color-cream-50);
    --color-surface: var(--color-cream-100);
    --color-text: var(--color-slate-900);
    --color-primary: var(--color-teal-500);
    
    /* –¢–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞ */
    --font-family-base: "FKGroteskNeue", "Geist", "Inter", sans-serif;
    --font-size-base: 14px;
    --line-height-normal: 1.5;
    
    /* –û—Ç—Å—Ç—É–ø—ã */
    --space-8: 8px;
    --space-16: 16px;
    --space-24: 24px;
    
    /* –†–∞–¥–∏—É—Å—ã */
    --radius-base: 8px;
    --radius-lg: 12px;
    
    /* –¢–µ–Ω–∏ */
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04);
}
```

**–¢–µ–º–Ω–∞—è —Ç–µ–º–∞**:
```css
@media (prefers-color-scheme: dark) {
    :root {
        --color-background: var(--color-charcoal-700);
        --color-surface: var(--color-charcoal-800);
        --color-text: var(--color-gray-200);
        --color-primary: var(--color-teal-300);
    }
}
```

**–ö–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã**:

#### –ö–∞—Ä—Ç–æ—á–∫–∏ —Ñ–∏–ª—å–º–æ–≤
```css
.film-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: var(--space-24);
    align-items: start;
}

.film-card {
    background: var(--color-surface);
    border: 1px solid var(--color-card-border);
    border-radius: var(--radius-lg);
    display: flex;
    flex-direction: column;
    height: 100%;
}

.film-poster {
    width: 100%;
    height: 400px;  /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
    overflow: hidden;
}

.film-poster-image {
    width: 100%;
    height: 100%;
    object-fit: cover;  /* –ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–±—Ä–µ–∑–∞–Ω–∏–µ */
    object-position: center top;
}

.film-info {
    padding: var(--space-16);
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    min-height: 200px;
}

.film-title {
    color: var(--color-primary);
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-semibold);
    min-height: 2.4em;  /* –†–µ–∑–µ—Ä–≤ –¥–ª—è 2 —Å—Ç—Ä–æ–∫ */
}

.film-description {
    flex-grow: 1;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 3;  /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ 3 —Å—Ç—Ä–æ–∫ */
    -webkit-box-orient: vertical;
}

.film-metadata {
    margin-top: auto;  /* –ü—Ä–∏–∂–∏–º–∞–µ–º –∫ –Ω–∏–∑—É */
    padding-top: var(--space-8);
    border-top: 1px solid var(--color-card-border-inner);
}
```

#### –ü–∞–≥–∏–Ω–∞—Ü–∏—è
```css
.pagination {
    display: flex;
    justify-content: center;
    gap: var(--space-8);
    margin-top: var(--space-32);
}

.page-button {
    padding: var(--space-8) var(--space-16);
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    cursor: pointer;
    border-radius: var(--radius-base);
}

.page-button.active {
    background: var(--color-primary);
    color: var(--color-btn-primary-text);
}
```

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```css
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: var(--space-24);
}

.stat-item {
    background: var(--color-secondary);
    border-left: 4px solid var(--color-primary);
    padding: var(--space-16);
    border-radius: var(--radius-sm);
}
```

**–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å**:
```css
@media (max-width: 768px) {
    .film-grid {
        grid-template-columns: 1fr;
    }
    
    .film-poster {
        height: 320px;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
}
```

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### local_settings.py - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î

**MySQL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
```python
HOST = 'ich-db.edu.itcareerhub.de'
USER = 'ich1'
PASSWORD = 'password'
DATABASE = 'sakila'

dbconfig = {
    'host': HOST,
    'user': USER,
    'password': PASSWORD,
    'database': DATABASE,
}
```

**MongoDB –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
```python
MONGODB_URL_READ = 'mongodb://user:pass@host:port/?authSource=db'
MONGODB_URL_WRITE = 'mongodb://user:pass@host:port/?authSource=db'
```

**–í–∞–∂–Ω–æ**: –≠—Ç–æ—Ç —Ñ–∞–π–ª –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞–¥–∞—Ç—å –≤ Git!

### tmdb_config.py - TMDB API

```python
TMDB_API_KEY = "your_tmdb_api_key_here"
TMDB_BASE_URL = "https://api.themoviedb.org/3"
TMDB_IMAGE_BASE_URL = "https://image.tmdb.org/t/p/w500"
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–∞**: –°–º. [TMDB_SETUP.md](TMDB_SETUP.md)

### requirements.txt - –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```
fastapi==0.104.1
uvicorn==0.24.0
pydantic==2.5.0
mysql-connector-python==8.2.0
pymongo==4.6.0
python-multipart==0.0.6
requests==2.31.0
```

---

## –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–∞ (–ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª)

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç "matrix" –∏ –Ω–∞–∂–∏–º–∞–µ—Ç "–ü–æ–∏—Å–∫"
   ‚Üì
2. JavaScript: searchByKeyword(1)
   ‚Üì
3. AJAX –∑–∞–ø—Ä–æ—Å: GET /api/search/keyword?q=matrix&page=1
   ‚Üì
4. FastAPI: films.py ‚Üí search_by_keyword()
   ‚Üì
5. MySQL: mysql_connector.py ‚Üí search_by_keyword("matrix", 1, 10)
   ‚Üì
6. SQL: SELECT * FROM film WHERE title LIKE '%matrix%' LIMIT 10 OFFSET 0
   ‚Üì
7. –û–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:
   - get_film_actors(film_id) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª—å–º–∞
   - get_film_categories(film_id) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª—å–º–∞
   - get_poster_for_film(title, year) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª—å–º–∞
   ‚Üì
8. TMDB API (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω):
   - –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ: "MATRIX SOMETHING" ‚Üí "The Matrix"
   - –ü–æ–∏—Å–∫ –ø–æ—Å—Ç–µ—Ä–∞ –≤ TMDB
   - –í–æ–∑–≤—Ä–∞—Ç URL –∏–ª–∏ —ç–º–æ–¥–∑–∏
   ‚Üì
9. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ MongoDB:
   - log_writer.log_search(...)
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é
   ‚Üì
10. –í–æ–∑–≤—Ä–∞—Ç JSON –∫–ª–∏–µ–Ω—Ç—É:
    {
        "total_count": 3,
        "page": 1,
        "page_size": 10,
        "films": [...]
    }
   ‚Üì
11. JavaScript: displayResults()
    - –°–æ–∑–¥–∞–Ω–∏–µ HTML –∫–∞—Ä—Ç–æ—á–µ–∫
    - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å—Ç–µ—Ä–æ–≤
    - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
   ‚Üì
12. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–∫–ª–∞–¥–∫—É "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
   ‚Üì
2. JavaScript: loadStats()
   ‚Üì
3. –î–≤–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞:
   - GET /api/stats/popular
   - GET /api/stats/recent
   ‚Üì
4. MongoDB Aggregation:
   - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—è–º
   - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ –ª–∏–º–∏—Ç
   ‚Üì
5. –í–æ–∑–≤—Ä–∞—Ç –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç—É
   ‚Üì
6. JavaScript:
   - displayPopularStats()
   - displayRecentStats()
   ‚Üì
7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### SQL Injection Protection
```python
# ‚ùå –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ
query = f"SELECT * FROM film WHERE title LIKE '%{keyword}%'"

# ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ
query = "SELECT * FROM film WHERE title LIKE %s"
cursor.execute(query, (f"%{keyword}%",))
```

### XSS Protection
```javascript
// ‚ùå –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ
element.innerHTML = film.title;

// ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ
function escapeHtml(text) {
    const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
    };
    return text.replace(/[&<>"']/g, m => map[m]);
}
element.innerHTML = escapeHtml(film.title);
```

### CORS Configuration
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # –í production —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```python
# .gitignore
local_settings.py
tmdb_config.py
*.log
__pycache__/
.venv/
```

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–µ—Ä–æ–≤
```python
POSTER_CACHE = {}  # In-memory –∫—ç—à

# –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ
poster = get_poster_for_film("Matrix", 1999)
# ‚Üí –ó–∞–ø—Ä–æ—Å –∫ TMDB API
# ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ POSTER_CACHE["Matrix_1999"]

# –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ
poster = get_poster_for_film("Matrix", 1999)
# ‚Üí –í–æ–∑–≤—Ä–∞—Ç –∏–∑ POSTER_CACHE (–±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –∫ API)
```

### –ü–∞–≥–∏–Ω–∞—Ü–∏—è
```python
# –í–º–µ—Å—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
films = mysql_db.search_by_keyword("matrix", page=1, page_size=10)
# ‚Üí LIMIT 10 OFFSET 0

# –°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
films = mysql_db.search_by_keyword("matrix", page=2, page_size=10)
# ‚Üí LIMIT 10 OFFSET 10
```

### MongoDB Aggregation
```javascript
// –í–º–µ—Å—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤ Python
// –ò—Å–ø–æ–ª—å–∑—É–µ–º aggregation pipeline –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ MongoDB
db.collection.aggregate([
    { $group: ... },
    { $sort: ... },
    { $limit: 5 }
])
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é**:
1. –í–≤–µ—Å—Ç–∏ "ape" ‚Üí –û–∂–∏–¥–∞–µ—Ç—Å—è: 10+ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
2. –í–≤–µ—Å—Ç–∏ "xyz123" ‚Üí –û–∂–∏–¥–∞–µ—Ç—Å—è: "–§–∏–ª—å–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
3. –ü–∞–≥–∏–Ω–∞—Ü–∏—è ‚Üí –û–∂–∏–¥–∞–µ—Ç—Å—è: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è

**–ü–æ–∏—Å–∫ –ø–æ –∂–∞–Ω—Ä—É**:
1. –í—ã–±—Ä–∞—Ç—å "Action" ‚Üí –û–∂–∏–¥–∞–µ—Ç—Å—è: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –ª–µ—Ç
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–æ–¥—ã 2000-2010 ‚Üí –û–∂–∏–¥–∞–µ—Ç—Å—è: —Ñ–∏–ª—å–º—ã –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ
3. –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π –∂–∞–Ω—Ä ‚Üí –û–∂–∏–¥–∞–µ—Ç—Å—è: –Ω–æ–≤—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**:
1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–∏—Å–∫–æ–≤
2. –û—Ç–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö
4. –£–±–µ–¥–∏—Ç—å—Å—è –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥—É–±–ª–µ–π

**–ü–æ—Å—Ç–µ—Ä—ã**:
1. –° TMDB API ‚Üí –û–∂–∏–¥–∞–µ—Ç—Å—è: –Ω–∞—Å—Ç–æ—è—â–∏–µ –ø–æ—Å—Ç–µ—Ä—ã
2. –ë–µ–∑ API ‚Üí –û–∂–∏–¥–∞–µ—Ç—Å—è: —ç–º–æ–¥–∑–∏ –ø–æ—Å—Ç–µ—Ä—ã
3. –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ‚Üí –û–∂–∏–¥–∞–µ—Ç—Å—è: fallback –Ω–∞ —ç–º–æ–¥–∑–∏

---

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Production —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
```python
import os

MYSQL_HOST = os.getenv('MYSQL_HOST', 'localhost')
MYSQL_USER = os.getenv('MYSQL_USER', 'root')
MONGODB_URL = os.getenv('MONGODB_URL', 'mongodb://localhost:27017')
TMDB_API_KEY = os.getenv('TMDB_API_KEY', '')
```

**2. Gunicorn –≤–º–µ—Å—Ç–æ Uvicorn**:
```bash
gunicorn main:app -w 4 -k uvicorn.workers.UvicornWorker
```

**3. Nginx reverse proxy**:
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    location /static {
        alias /path/to/static;
    }
}
```

**4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
```python
import logging

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('app.log'),
        logging.StreamHandler()
    ]
)
```

**5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**:
- Health check endpoint: `/health`
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ë–î

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç:
- ‚úÖ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ –†–∞–±–æ—Ç—É —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (MySQL, MongoDB)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –≤–Ω–µ—à–Ω–∏–º–∏ API (TMDB)
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –°–æ–±–ª—é–¥–µ–Ω–∏–µ best practices (PEP8, –º–æ–¥—É–ª—å–Ω–æ—Å—Ç—å)

**–ê–≤—Ç–æ—Ä**: –ü—Ä–æ–µ–∫—Ç Film Search  
**–î–∞—Ç–∞**: –Ø–Ω–≤–∞—Ä—å 2026  
**–í–µ—Ä—Å–∏—è**: 1.0.0